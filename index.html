<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>田丰硕个人博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="田丰硕个人博客-误入拍(P)黄(H)片(P)之路">
<meta property="og:type" content="website">
<meta property="og:title" content="田丰硕个人博客">
<meta property="og:url" content="http://blog.tianfs.com/index.html">
<meta property="og:site_name" content="田丰硕个人博客">
<meta property="og:description" content="田丰硕个人博客-误入拍(P)黄(H)片(P)之路">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="tianfs">
<meta property="article:tag" content="田丰硕">
<meta property="article:tag" content="个人博客">
<meta property="article:tag" content="php">
<meta property="article:tag" content="博客">
<meta property="article:tag" content="丰硕">
<meta property="article:tag" content="mysq">
<meta property="article:tag" content="html">
<meta property="article:tag" content="css">
<meta property="article:tag" content="javascript">
<meta property="article:tag" content="js">
<meta property="article:tag" content="jquery">
<meta property="article:tag" content="田丰硕个人博客">
<meta property="article:tag" content="php博客">
<meta property="article:tag" content="web前端">
<meta property="article:tag" content="redis">
<meta property="article:tag" content="linux">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="田丰硕个人博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">田丰硕个人博客</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">误入拍(P)黄(H)片(P)之路</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.tianfs.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-docker遇到的一些问题" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/10/21/docker%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98/" class="article-date">
  <time datetime="2020-10-21T04:46:47.000Z" itemprop="datePublished">2020-10-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9C%8D%E5%8A%A1%E7%AB%AF/">服务端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/21/docker%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98/">docker遇到的一些问题</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="docker个人遇到的问题一些备注"><a href="#docker个人遇到的问题一些备注" class="headerlink" title="docker个人遇到的问题一些备注"></a>docker个人遇到的问题一些备注</h3><p>1) 如果出现 bash: vim : command not found  需要安装下vim</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ apt-get update</span><br><span class="line">$ apt-get install vim</span><br></pre></td></tr></table></figure>

<p>2) 如果出现 bash: apt-get : command not found  尝试使用yum安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum install vim -y</span><br></pre></td></tr></table></figure>

<p>3) 如果容器内出现 [Errno 13] Permission denied (错误描述如下)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ yum install vim -y</span><br><span class="line">  Loaded plugins: fastestmirror, ovl</span><br><span class="line">  ovl: Error <span class="keyword">while</span> doing RPMdb copy-up:</span><br><span class="line">  [Errno 13] Permission denied: <span class="string">'/var/lib/rpm/Basenames'</span></span><br><span class="line">  You need to be root to perform this <span class="built_in">command</span>.</span><br></pre></td></tr></table></figure>

<ul>
<li>是因为进入用户不是root权限,进入容器时增加 –user root 参数 （docker exec -it –user root  容器 bash）</li>
</ul>
<p>4) 查看所有容器的ip</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker inspect --format=<span class="string">'&#123;&#123;.Name&#125;&#125; - &#123;&#123;range.NetworkSettings.Networks&#125;&#125;&#123;&#123;.IPAddress&#125;&#125;&#123;&#123;end&#125;&#125;'</span> $(docker ps -aq)</span><br></pre></td></tr></table></figure>
<p>5) docker中安装php扩展</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker-php-ext-install pdo</span><br></pre></td></tr></table></figure>
<p>6) 提示文件挂载目录不可使用<br>可以查看一下doc可以挂载的授权目录的列表可以在桌面版上看一下<br><img src="https://pic.tianfs.com/uPic/4hNwhh.png" alt="4hNwhh"><br>7) 如果创建网络出现 ERROR: Pool overlaps with other one on this address space<br>该错误的意思是docker已有一个容器占用了目前docker-compose里的subnet。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network prune</span><br></pre></td></tr></table></figure>
<h3 id="docker网络模式"><a href="#docker网络模式" class="headerlink" title="docker网络模式"></a>docker网络模式</h3><h4 id="bridge模式-默认-（–network-bridge）"><a href="#bridge模式-默认-（–network-bridge）" class="headerlink" title="bridge模式(默认)（–network=bridge）"></a>bridge模式(默认)（–network=bridge）</h4><ul>
<li>创建一个名为docker0的虚拟网桥,并将容器连接到一个docker0虚拟网桥,所有网桥下的容器共享Network Namespace</li>
</ul>
<ul>
<li>可以关闭容器见通信，在DOCKER_OPTS变量中设置–icc=false，这样只有使用–link才能使两个容器通信。<br><img src="https://pic.tianfs.com/uPic/vWMAEu.png" alt="vWMAEu"><h4 id="host模式（–network-host）"><a href="#host模式（–network-host）" class="headerlink" title="host模式（–network=host）"></a>host模式（–network=host）</h4></li>
</ul>
<ul>
<li>容器和宿主机共享Network，使用宿主机的IP和端口,容器可以直接使用宿主机的IP地址与外界通信</li>
<li>网络性能比较好，网络的隔离性不好，<br><img src="https://pic.tianfs.com/uPic/ESCn9R.png" alt="ESCn9R"><h4 id="none模式-（–network-none）"><a href="#none模式-（–network-none）" class="headerlink" title="none模式 （–network=none）"></a>none模式 （–network=none）</h4></li>
<li>拥有自己的Network Namespace，该模式默认关闭了容器的网络功能，需要自己配置。<br><img src="https://pic.tianfs.com/uPic/7Ojq4g.png" alt="7Ojq4g"><h4 id="container模式-（–network-container-NAME-or-ID）"><a href="#container模式-（–network-container-NAME-or-ID）" class="headerlink" title="container模式 （–network=container:NAME_or_ID）"></a>container模式 （–network=container:NAME_or_ID）</h4></li>
<li>容器和另外一个容器共享Network namespace,而不是和宿主机共享<br><img src="https://pic.tianfs.com/uPic/CnSpBL.png" alt="CnSpBL"></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.tianfs.com/2020/10/21/docker%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98/" data-id="ckgwgxmof000fjlh50kq01bmu" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/" rel="tag">docker</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-docker安装php开发环境" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/10/21/docker%E5%AE%89%E8%A3%85php%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/" class="article-date">
  <time datetime="2020-10-21T04:46:47.000Z" itemprop="datePublished">2020-10-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9C%8D%E5%8A%A1%E7%AB%AF/">服务端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/21/docker%E5%AE%89%E8%A3%85php%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/">docker安装php开发环境</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="序言"><a href="#序言" class="headerlink" title="序言"></a>序言</h2><ul>
<li>本文继续mac os系统演示</li>
<li>本文基于本地开发安装环境用于演示</li>
<li>nginx-1.19.3、php-7.3、redis:6.0<h3 id="一、安装docker"><a href="#一、安装docker" class="headerlink" title="一、安装docker"></a>一、安装docker</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew cask install docker</span><br></pre></td></tr></table></figure>
<h3 id="二、安装需要了解的概念和基础命令"><a href="#二、安装需要了解的概念和基础命令" class="headerlink" title="二、安装需要了解的概念和基础命令"></a>二、安装需要了解的概念和基础命令</h3><h4 id="1、docker的组成"><a href="#1、docker的组成" class="headerlink" title="1、docker的组成"></a>1、docker的组成</h4>docker由 仓库、镜像、容器三大部分组成<br>1）镜像：可以想想成为模版，例如windows系统的镜像，<br>2）容器：通过启动镜像来生成容器，就是我们环境中真实要使用到的服务存储的地方 一般由 一个linux系统内包含一个应用服务组成（例如linux中安装了一个php）<br>3）仓库：用来集中存储镜像的的地方，一般我们使用 docker hub （hub.docker.com）<br>容器与镜像的关系类似于面向对象编程中的对象与类</li>
<li>如果用git来对比举例:<br>镜像则为一个维护好的master主分支<br>容器则是我们自己定义使用的开发分支，但是不能合并到主分支<br>仓库则为git的代码存放仓库了<h4 id="2、环境的安装方式"><a href="#2、环境的安装方式" class="headerlink" title="2、环境的安装方式"></a>2、环境的安装方式</h4>1）使用docker安装一个linux虚拟机，然后在虚拟机中使用linux相关命令安装php相关开发环境，这就和docker没啥太大关系了<br>2）使用docker分别nginx、PHP、redis等多个应用服务容器然后用docker的网关进行链接通信<br><img src="https://pic.tianfs.com/uPic/fLoeSW.png" alt="fLoeSW"><h4 id="3、环境安装方法"><a href="#3、环境安装方法" class="headerlink" title="3、环境安装方法"></a>3、环境安装方法</h4></li>
<li>分为普通基础安装：<br>一个一个安装，官方样例经常出现的方式</li>
<li>使用docker-composer安装：<br>使用docker compose 配置文件（yml文件），配置应用程序需要的所有服务，然后使用一个命令自动安装所有东西（例如php 的composer.json 和compose install）</li>
<li>本文会先介绍基础安装，然后介绍 docker-composer 方式 <h3 id="4、常用基础命令"><a href="#4、常用基础命令" class="headerlink" title="4、常用基础命令"></a>4、常用基础命令</h3>1) docker images(docker image ls) :来列出本地主机上已经下载的镜像<br>2) docker pull :用来从远程仓库下载镜像<br>3) docker search :在仓库中搜索镜像<br>4）docker run ：运行镜像生成并生成容器<br>5）docker ps ：查看正在运行的容器的列表<br>6）docker ps -a:查看本地已经生成的容器（包含未运行的）<br>7）docker exec :进入到容器中，可以想想未ssh进入到了一个linux系统</li>
</ul>
<h2 id="三、安装nginx"><a href="#三、安装nginx" class="headerlink" title="三、安装nginx"></a>三、安装nginx</h2><h4 id="1、下载nginx镜像"><a href="#1、下载nginx镜像" class="headerlink" title="1、下载nginx镜像"></a>1、下载nginx镜像</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull nginx:1.19.3</span><br></pre></td></tr></table></figure>
<p>这样nginx镜像就下载下来了，可以用 docker images 查看<br><img src="https://pic.tianfs.com/uPic/iH1PtX.png" alt="iH1PtX"></p>
<h4 id="2、运行镜像生成容器"><a href="#2、运行镜像生成容器" class="headerlink" title="2、运行镜像生成容器"></a>2、运行镜像生成容器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --name nginx-1.19.3</span><br><span class="line">-v ~/mycode:/usr/share/nginx/html </span><br><span class="line">-v ~/docker-volumes/nginx/config:/etc/nginx/conf.d </span><br><span class="line">-v /tmp/docker-log/nginx:/var/<span class="built_in">log</span>/nginx</span><br><span class="line"> -p 80:80 -d nginx:1.19.3</span><br></pre></td></tr></table></figure>
<p>参数说明：<br>-v 表示目录映射关系（前者是宿主机目录，后者是映射到宿主机上的目录），可以使用多个－v做多个目录或文件映射。注意：最好做目录映射，在宿主机上做修改，然后共享到容器上<br>–name nginx-1.19.3：设置容器名称。<br>-p 80:80： 端口进行映射，将本地 80 端口映射到容器内部的 80 端口。<br>-d： 设置容器在在后台一直运行。</p>
<p><img src="https://pic.tianfs.com/uPic/sJ46Dc.png" alt="sJ46Dc"></p>
<h4 id="3、创建配置文件、进入容器逛一逛"><a href="#3、创建配置文件、进入容器逛一逛" class="headerlink" title="3、创建配置文件、进入容器逛一逛"></a>3、创建配置文件、进入容器逛一逛</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">exec</span> -it  nginx-1.19.3</span><br></pre></td></tr></table></figure>
<p>进来后可以看看nginx的配置文件等信息， </p>
<p>现在我们已经把配置文件映射到宿主机上了我们可一到宿主机的对应目录调调改改nginx配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#宿主机 config</span></span><br><span class="line"> server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name mytest.com;</span><br><span class="line">        root    /usr/share/nginx/html;</span><br><span class="line">        location / &#123;</span><br><span class="line">            index index.html index.htm index.php;</span><br><span class="line">            try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.php?<span class="variable">$query_string</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        location ~ \.php$ &#123;</span><br><span class="line">    	      fastcgi_param APP_ENV dev;</span><br><span class="line">            fastcgi_split_path_info ^(.+\.php)(/.+)$;</span><br><span class="line">            fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">            fastcgi_index index.php;</span><br><span class="line">            include fastcgi_params;</span><br><span class="line">            fastcgi_param SCRIPT_FILENAME <span class="variable">$document_root</span><span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">        &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>然后exit退出 ，然后重启下nginx </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker restart  nginx-1.19.3</span><br></pre></td></tr></table></figure>

<p>现在我们就可以运行我们的nginx了 127.0.0.1<br>但是现在只能运行查看html等静态文件，看不了php，这是为什么呢？因为我们还没装php</p>
<h2 id="三、安装php"><a href="#三、安装php" class="headerlink" title="三、安装php"></a>三、安装php</h2><h4 id="1、下载php"><a href="#1、下载php" class="headerlink" title="1、下载php"></a>1、下载php</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull php:7.3</span><br></pre></td></tr></table></figure>
<h4 id="2、运行镜像生成容器-1"><a href="#2、运行镜像生成容器-1" class="headerlink" title="2、运行镜像生成容器"></a>2、运行镜像生成容器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --name  php-7.3</span><br><span class="line">-v ~/mycode:/usr/share/nginx/html </span><br><span class="line">--expose=9000 </span><br><span class="line">-d php:7.3</span><br></pre></td></tr></table></figure>
<p>参数说明：<br>-expose 对其他容器报漏9000端口,但不能和主机通信 。<br>重点说明：<br>-此处php挂在的目录需要与nginx中的www目录相同，因为正常来说nginx和php在一台机器上，www目录要php和nginx都能访问到</p>
<p>-可以运行后发现好多扩展没有，可以使用进入docker容器使用docker提供的命令进行安装 例如mysql<br>因为使用的源是fpm包 所以很多扩展都没有装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker-php-ext-install pdo</span><br><span class="line">$ docker-php-ext-install pdo_mysql</span><br></pre></td></tr></table></figure>
<h2 id="四、容器和容器间通信"><a href="#四、容器和容器间通信" class="headerlink" title="四、容器和容器间通信"></a>四、容器和容器间通信</h2><ul>
<li><p>现在已经安装了nginx和php了为啥还是不能解析php文件呢<br>原因在于nginx和php两个容器之间还有没进行通信<br>那么怎么进行通信呢<br>1、我们要修修改nginx中fastcgi中请求php的地址参数 fastcgi_pass 127.0.0.1:9000; 改为 fastcgi_pass 172.25.0.2:9000;<br>2、重启nginx，就可以了呀</p>
</li>
<li><p>那么问题来了。这个php的ip哪来的。<br>我们默认使用docker的bridge模式 此网络创建一个名为docker0的虚拟网桥,并将容器连接到一个docker0虚拟网桥,所有网桥下的容器共享Network Namespace</p>
<h2 id="五、使用docker-compose-安装nginx、php"><a href="#五、使用docker-compose-安装nginx、php" class="headerlink" title="五、使用docker compose 安装nginx、php"></a>五、使用docker compose 安装nginx、php</h2><p>上面已经大致的了解了怎么安装nginx和php了 ，mysql和上面的方法一样我就不举例了<br>下面说如何使用compose进行安装呢？compose安装都需要什么呢？</p>
</li>
</ul>
<h4 id="1、compose安装环境的流程"><a href="#1、compose安装环境的流程" class="headerlink" title="1、compose安装环境的流程"></a>1、compose安装环境的流程</h4><p>  使用 Dockerfile 定义应用程序的环境。<br>  使用 docker-compose.yml 定义构成应用程序的服务，这样它们可以在隔离环境中一起运行。<br>  最后，执行 docker-compose up 命令来启动并运行整个应用程序。</p>
<p>Dockerfile 这个玩意没有也能装，他是用来自定义镜像的，我们用通用镜像就可以</p>
<h4 id="2、上docker-compose-yml-文件"><a href="#2、上docker-compose-yml-文件" class="headerlink" title="2、上docker-compose.yml 文件"></a>2、上docker-compose.yml 文件</h4><ul>
<li>随便找个地方件个文件夹，进去到里面创建的xxxx.yml文件，我的叫composetest.yml</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"3"</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">local_net:</span></span><br><span class="line">    <span class="attr">external:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">local_net</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">nginx:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">local-nginx-1.19.3</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.19.3</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"80:80"</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">~/mycode:/usr/share/nginx/html</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">~/docker-volumes/nginx/config:/etc/nginx/conf.d</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/tmp/docker-log/nginx:/var/log/nginx</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="attr">local_net:</span></span><br><span class="line">        <span class="attr">ipv4_address:</span> <span class="number">172.25</span><span class="number">.0</span><span class="number">.3</span></span><br><span class="line">    <span class="attr">extra_hosts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">"local.testdoctor.meidaifu.com:127.0.0.1"</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">"local.patient.meidaifu.com:127.0.0.1"</span></span><br><span class="line">       </span><br><span class="line">  <span class="attr">php:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">local-php-7.3-fpm</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">php:7.3-fpm</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">~/mycode:/usr/share/nginx/html</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="attr">local_net:</span></span><br><span class="line">        <span class="attr">ipv4_address:</span> <span class="number">172.25</span><span class="number">.0</span><span class="number">.2</span></span><br><span class="line">    <span class="attr">stdin_open:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">tty:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">expose:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9000</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">local-redis-6.0</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:6.0</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="attr">local_net:</span></span><br><span class="line">        <span class="attr">ipv4_address:</span> <span class="number">172.25</span><span class="number">.0</span><span class="number">.6</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"6379:6379"</span></span><br><span class="line">    <span class="attr">expose:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">6379</span></span><br><span class="line">  <span class="attr">mysql:</span></span><br><span class="line">      <span class="attr">container_name:</span> <span class="string">local-mysql-8.0</span>        <span class="comment"># 指定容器的名称</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">mysql:8.0</span>                   <span class="comment"># 指定镜像和版本</span></span><br><span class="line">      <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">"3306:3306"</span></span><br><span class="line">      <span class="attr">expose:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">3306</span></span><br><span class="line">      <span class="attr">environment:</span></span><br><span class="line">        <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="string">"root"</span></span><br><span class="line">        <span class="attr">MYSQL_ROOT_HOST:</span> <span class="string">"%"</span></span><br><span class="line">      <span class="attr">networks:</span></span><br><span class="line">        <span class="attr">local_net:</span></span><br><span class="line">          <span class="attr">ipv4_address:</span> <span class="number">172.25</span><span class="number">.0</span><span class="number">.7</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">"~/docker-volumes/mysql/data:/var/lib/mysql"</span>     <span class="comment"># 挂载数据目录</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">"~/docker-volumes/mysql/config:/etc/mysql/conf.d"</span>      <span class="comment"># 挂载配置文件目录</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>参数解释<br>version：这个是表示用哪个docker-compose版本来解析，不用版本模版语法有差异 这里用的3<br>networks：用来声明所使用的网络环境<br>services：这个就是服务容器的集合，里面每一块都是一个服务<br>container_name：用来定一容器的名称<br>image：表示锁使用镜像的，也可以使用build命令来指定dockerfile文件路径从上下文路径 ./Dockerfile 所构建镜像<br>volumes：挂载<br>services 中的networks这里来指定使用哪个网络，指定当前容器在当前网段的ip<br>expose：对外报漏的端口<br>ports：宿主机和容器的端口映射</p>
</li>
<li><p>注意事项<br>1) 如果指定ip需要自己创建一个网络空间 不能使用默认的，这也解决了每次容器ip变动的问题</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network local_net bridge</span><br></pre></td></tr></table></figure>
<p><img src="https://pic.tianfs.com/uPic/Fd7VpT.png" alt="Fd7VpT"><br>2) 关于虚拟域名配置<br>这就要做一下nginx容器的host配置如上yml文件中extra_hosts，当前宿主机的本地host也要加</p>
</li>
</ul>
<p>然后修改nginx的配置 如下是我的meidaifu.conf的配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name local.testdoctor.meidaifu.com ;</span><br><span class="line">    root    /usr/share/nginx/html/onepiece/public;</span><br><span class="line">    location / &#123;</span><br><span class="line">        index index.html index.htm index.php;</span><br><span class="line">        try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.php?<span class="variable">$query_string</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    location ~ \.php$ &#123;</span><br><span class="line">	fastcgi_param APP_ENV dev;</span><br><span class="line">        fastcgi_split_path_info ^(.+\.php)(/.+)$;</span><br><span class="line">        fastcgi_pass 172.25.0.2:9000;</span><br><span class="line">        fastcgi_index index.php;</span><br><span class="line">        include fastcgi_params;</span><br><span class="line">        fastcgi_param SCRIPT_FILENAME <span class="variable">$document_root</span><span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen      80;</span><br><span class="line">    server_name local.patient.meidaifu.com;</span><br><span class="line">    root    /usr/share/nginx/html/onepiece_patient/public;</span><br><span class="line">    location / &#123;</span><br><span class="line">        index index.html index.htm index.php;</span><br><span class="line">        try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.php?<span class="variable">$query_string</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    location ~ \.php$ &#123;</span><br><span class="line">	fastcgi_param APP_ENV dev;</span><br><span class="line">        fastcgi_split_path_info ^(.+\.php)(/.+)$;</span><br><span class="line">        fastcgi_pass 172.25.0.2:9000;</span><br><span class="line">        fastcgi_index index.php;</span><br><span class="line">        include fastcgi_params;</span><br><span class="line">        fastcgi_param SCRIPT_FILENAME <span class="variable">$document_root</span><span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后修改yml文件 中nginx的配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">nginx:</span><br><span class="line">    container_name: local-nginx-1.19.3</span><br><span class="line">    image: nginx:1.19.3</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;80:80&quot;</span><br><span class="line">    volumes:</span><br><span class="line">      - ~&#x2F;mycode:&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html</span><br><span class="line">      - ~&#x2F;docker-volumes&#x2F;nginx&#x2F;config:&#x2F;etc&#x2F;nginx&#x2F;conf.d</span><br><span class="line">      - &#x2F;tmp&#x2F;docker-log&#x2F;nginx:&#x2F;var&#x2F;log&#x2F;nginx</span><br><span class="line">    networks:</span><br><span class="line">      local_net:</span><br><span class="line">        ipv4_address: 172.25.0.3</span><br><span class="line">    extra_hosts:</span><br><span class="line">    - &quot;local.testdoctor.meidaifu.com:127.0.0.1&quot;</span><br><span class="line">    - &quot;local.patient.meidaifu.com:127.0.0.1&quot;</span><br><span class="line">    depends_on:</span><br><span class="line">      - php</span><br></pre></td></tr></table></figure>
<h3 id="3、运行docker-compose"><a href="#3、运行docker-compose" class="headerlink" title="3、运行docker compose"></a>3、运行docker compose</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<p><img src="https://pic.tianfs.com/uPic/rc1Frn.png" alt="rc1Frn"><br>然后就可以运行了。</p>
<p>如果可以在果面版的docker中查看的更清楚<br><img src="https://pic.tianfs.com/uPic/dIgSAi.png" alt="dIgSAi"></p>
<p>docker-compose down 停止并删除容器<br><img src="https://pic.tianfs.com/uPic/67lyX4.png" alt="67lyX4"></p>
<p>docker-compose stop 停止并不删除容器<br><img src="https://pic.tianfs.com/uPic/wn49vN.png" alt="wn49vN"></p>
<h3 id="4、使用dockerfile自动增加PHP扩展"><a href="#4、使用dockerfile自动增加PHP扩展" class="headerlink" title="4、使用dockerfile自动增加PHP扩展"></a>4、使用dockerfile自动增加PHP扩展</h3><p>当前目录创建 phpfile/Dockerfile</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># base image</span></span><br><span class="line">FROM php:7.3-fpm</span><br><span class="line"></span><br><span class="line"><span class="comment"># MAINTAINER</span></span><br><span class="line">MAINTAINER tianfs</span><br><span class="line"></span><br><span class="line"><span class="comment"># running required command</span></span><br><span class="line">RUN docker-php-ext-install pdo_mysql</span><br></pre></td></tr></table></figure>

<p>然后修改 compose文件中php的配置为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">php:</span><br><span class="line">  container_name: local-php-7.3-fpm</span><br><span class="line">  build:</span><br><span class="line">    context: .&#x2F;phpfile</span><br><span class="line">    dockerfile: Dockerfile</span><br><span class="line">  image: php:7.3-fpm-local</span><br><span class="line">  volumes:</span><br><span class="line">    - ~&#x2F;mycode:&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html</span><br><span class="line">  networks:</span><br><span class="line">    local_net:</span><br><span class="line">      ipv4_address: 172.25.0.2</span><br><span class="line">  stdin_open: true</span><br><span class="line">  tty: true</span><br><span class="line">  expose:</span><br><span class="line">    - 9000</span><br></pre></td></tr></table></figure>
<p>build 和image 同时出现 则image 将为build后镜像生成的名字和tag<br>然后</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>
<p>然后你就可以拿这你的配置文件 到处耍了。</p>
<h2 id="六、注意事项"><a href="#六、注意事项" class="headerlink" title="六、注意事项"></a>六、注意事项</h2><p>查看另一片文章<a href="https://tianfs.com" target="_blank" rel="noopener">docker遇到的相关问题</a></p>
<h2 id="七、延伸思考"><a href="#七、延伸思考" class="headerlink" title="七、延伸思考"></a>七、延伸思考</h2><p>1、这种搭建方式是否符合最佳事实践方案标准？<br>2、如果多台服务器需要部署如何管理？</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.tianfs.com/2020/10/21/docker%E5%AE%89%E8%A3%85php%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/" data-id="ckgwgxmpg002qjlh53xt5e65x" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php%E7%8E%AF%E5%A2%83/" rel="tag">php环境</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-elasticsearch相关知识整理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/10/20/elasticsearch%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/" class="article-date">
  <time datetime="2020-10-20T04:46:47.000Z" itemprop="datePublished">2020-10-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9C%8D%E5%8A%A1%E7%AB%AF/">服务端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/20/elasticsearch%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/">elasticsearch知识整理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="ElasticSearch"><a href="#ElasticSearch" class="headerlink" title="ElasticSearch"></a>ElasticSearch</h2><p>elasticsearch 是一个基于Lucene的搜索服务器。它提供了一个分布式多用户能力的全文搜索引擎，基于RESTful web接口。Elasticsearch是用Java开发的，并作为Apache许可条款下的开放源码发布，是当前流行的企业级搜索引擎。</p>
<h4 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h4><ul>
<li>分布式，无需人工搭建集群（solr就需要人为配置，使用Zookeeper作为注册中心）</li>
<li>Restful风格，一切API都遵循Rest原则，容易上手</li>
<li>近实时搜索，数据更新在Elasticsearch中几乎是完全同步的。<h3 id="一、安装"><a href="#一、安装" class="headerlink" title="一、安装"></a>一、安装</h3><h4 id="1、docker方式安装elasticsearch"><a href="#1、docker方式安装elasticsearch" class="headerlink" title="1、docker方式安装elasticsearch"></a>1、docker方式安装elasticsearch</h4></li>
<li>安装<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull elasticsearch</span><br></pre></td></tr></table></figure></li>
<li>启动 (java程序访问可以在增加一个9300端口)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --name elasticsearch -p 9200:9200  -e <span class="string">"discovery.type=single-node"</span> -d elasticsearch</span><br></pre></td></tr></table></figure></li>
<li>进入容器修改配置<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">exec</span> -it elasticsearch /bin/bash</span><br><span class="line">$ <span class="built_in">cd</span> /usr/share/elasticsearch/config/</span><br><span class="line">$ vi elasticsearch.yml</span><br></pre></td></tr></table></figure></li>
<li>追加一下内容,解决跨域问题<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http.cors.enabled: <span class="literal">true</span></span><br><span class="line">http.cors.allow-origin: <span class="string">"*"</span></span><br></pre></td></tr></table></figure></li>
<li>重启容器<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">exit</span></span><br><span class="line">$ docker restart elasticsearch</span><br></pre></td></tr></table></figure>
默认访问链接<a href="http://127.0.0.1:9200就可以打开kibana的界面了。">http://127.0.0.1:9200就可以打开kibana的界面了。</a><h4 id="2、安装ik分词器"><a href="#2、安装ik分词器" class="headerlink" title="2、安装ik分词器"></a>2、安装ik分词器</h4>es自带的分词器对中文分词不是很友好，elasticsearch的版本和ik分词器的版本需要保持一致；<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /usr/share/elasticsearch/plugins/</span><br><span class="line">$ elasticsearch-plugin install 对应版本的安装包地址(https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.2.0/elasticsearch-analysis-ik-7.2.0.zip)</span><br><span class="line">$ <span class="built_in">exit</span></span><br><span class="line">$ docker restart elasticsearch 可以在kibana界面的dev tools中验证是否安装成功</span><br></pre></td></tr></table></figure>
<h4 id="3、docker安装kibana"><a href="#3、docker安装kibana" class="headerlink" title="3、docker安装kibana"></a>3、docker安装kibana</h4>可视化elasticsearch管理页面</li>
<li>安装 (要与es版本对应)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull kibana</span><br></pre></td></tr></table></figure></li>
<li>启动kibana(使用–link连接到elasticsearch容器 ,或者使用Network让其在同一个网络下) <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --name kibana  -p 5601:5601 -d kibana</span><br><span class="line">$ docker start kibana</span><br></pre></td></tr></table></figure>
浏览器输入<a href="http://127.0.0.1:5601就可以打开kibana的界面了。">http://127.0.0.1:5601就可以打开kibana的界面了。</a></li>
<li>遇到问题<br>1）访问提示 Kibana server is not ready yet<br>第一：把KB和ES版本调整为统一版本<br>第二：将配置文件kibana.yml中的elasticsearch.url改为正确的链接<br>第三：保持kibana和elasticsearch在同一个网络模式下，可以使用默认的bridge网络下的段的地址172.17.0.x<br>注意，默认为bridge网络，此网络下两个容器无法用127.0.0.x 的本地ip进行通信访问，如果想用要都切换到host模式</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.tianfs.com/2020/10/20/elasticsearch%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/" data-id="ckgwgxmoc000bjlh583jl2i4k" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/elasticsearch/" rel="tag">elasticsearch</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kibana/" rel="tag">kibana</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-分布式知识整理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/10/19/%E5%88%86%E5%B8%83%E5%BC%8F%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/" class="article-date">
  <time datetime="2020-10-19T04:46:47.000Z" itemprop="datePublished">2020-10-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9C%8D%E5%8A%A1%E7%AB%AF/">服务端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/19/%E5%88%86%E5%B8%83%E5%BC%8F%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/">分布式知识整理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="一、分布式事务"><a href="#一、分布式事务" class="headerlink" title="一、分布式事务"></a>一、分布式事务</h3><h4 id="1、tcc（最终一致性）"><a href="#1、tcc（最终一致性）" class="headerlink" title="1、tcc（最终一致性）"></a>1、tcc（最终一致性）</h4><ul>
<li>一般使用tcc分布式事务框架</li>
<li>实现的功能需要修改的代码比较多，需要个个系统配合完成try、commit和cancel方法</li>
<li>有try、commit和cancel三个阶段</li>
<li>TCC是业务层面的分布式事务，最终一致性，不会一直持有资源的锁。</li>
<li>try阶段保证各自服务本地资源一致</li>
<li>commit 和cancel只会有一个被执行 </li>
<li>try阶段有服务失败将触发cancel 如果cancel失败，那么走补偿机制，保证最终一致性</li>
<li>不会阻塞资源</li>
<li>执行流程<br>1) 成功流程：事务框架-&gt;try（请求所有服务预留业务资源,不阻塞）-&gt;成功-&gt;commit(所有服务正式提交修改)<br>2) 失败流程：事务框架-&gt;try（请求所有服务预留业务资源,不阻塞）-&gt;失败-&gt;cancel(告知所有服务取消预约)<br>3) commit/cancel 如果失败了，那么走补偿机制，保证最终一致性<h4 id="3、xa两段提交（强一致性）（阻塞）"><a href="#3、xa两段提交（强一致性）（阻塞）" class="headerlink" title="3、xa两段提交（强一致性）（阻塞）"></a>3、xa两段提交（强一致性）（阻塞）</h4></li>
<li>分为协调者(xa协调工具)、参与者(各服务)</li>
<li>XA是资源层面的分布式事务，强一致性，在两阶段提交的整个过程中，一直会持有资源的锁。</li>
<li>只有try 和commit 两个阶段</li>
<li>MySQL中只有InnoDB引擎支持XA协议</li>
<li>MySQL中只有当隔离级别为Serializable（最高界别，串行）时候才能使用分布式事务</li>
<li>执行流程<br>1) 成功流程：协调者-&gt;try（询问所有服务是否可以执行,持有资源的锁）-&gt;成功-&gt;协调者通知commit(所有服务正式提交修改),解除资源锁定<br>2) 失败流程：协调者-&gt;try（询问所有服务是否可以执行,持有资源的锁）-&gt;失败-&gt;协调者通知rollback,解除资源锁定</li>
</ul>
<h4 id="2、mq事务消息（最终一致性）"><a href="#2、mq事务消息（最终一致性）" class="headerlink" title="2、mq事务消息（最终一致性）"></a>2、mq事务消息（最终一致性）</h4><ul>
<li>实现的功能需要修改的代码相对较少，消费端几乎不需要任何修改</li>
<li>只能保证（生产端的业务和消息投递到mq同时成功）</li>
<li>消费端消费失败走补偿机制，保证最终一致性</li>
<li>执行流程<br>1) 服务a向mq发送prepare消息（本地事务，消费端不会收到）-&gt;mq得到返回给服务a执行结果-&gt;只能服务a本地业务<br>2) 服务a本地业务执行成功-&gt;向mq发送事务消息的提交commitlog-&gt;消息出现在真实的mq消息中-&gt;消费端接收处理<br>3) 服务a本地业务执行失败-&gt;向mq发送事务消息的撤销commitlog-&gt;移除事务消息<br>4) 如果mq未收到事务的commit/rollback则会回查事务状态，然后继续执行<h4 id="4、最大努力通知"><a href="#4、最大努力通知" class="headerlink" title="4、最大努力通知"></a>4、最大努力通知</h4></li>
<li>不可靠消息：业务活动主动方，在完成业务处理之后，向业务活动的被动方发送消息，直到通知N次后不再通知，允许消息丢失(不可靠消息)。</li>
<li>定期校对：业务活动的被动方，根据定时策略，向业务活动主动方查询(主动方提供查询接口)，恢复丢失的业务消息。<h4 id="5、可靠消息最终一致性"><a href="#5、可靠消息最终一致性" class="headerlink" title="5、可靠消息最终一致性"></a>5、可靠消息最终一致性</h4></li>
<li>是指产生消息的业务动作与消息发送的一致</li>
<li>如果业务操作成功，那么由这个业务操作所产生的消息一定要成功投递出去</li>
<li>异步确保性</li>
<li>一般可以使用mq事务消息实现<h3 id="二、分布式锁"><a href="#二、分布式锁" class="headerlink" title="二、分布式锁"></a>二、分布式锁</h3><h4 id="1、基于缓存（Redis等）实现分布式锁"><a href="#1、基于缓存（Redis等）实现分布式锁" class="headerlink" title="1、基于缓存（Redis等）实现分布式锁"></a>1、基于缓存（Redis等）实现分布式锁</h4></li>
<li>主要使用命令：<br>1）SETNX key val：当且仅当key不存在时，set一个key为val的字符串，返回1；若key存在，则什么都不做，返回0。<br>2）expire key timeout：为key设置一个超时时间，单位为second，超过这个时间锁会自动释放，避免死锁。<br>2）delete key ：删除key。</li>
<li>实现思想：<br>1）获取锁的时候，使用setnx加锁，并使用expire命令为锁添加一个超时时间，超过该时间则自动释放锁，锁的value值为一个随机生成的UUID，通过此在释放锁的时候进行判断。<br>2）获取锁的时候还设置一个获取的超时时间，若超过这个时间则放弃获取锁。<br>3）释放锁的时候，通过UUID判断是不是该锁，若是该锁，则执行delete进行锁释放。</li>
</ul>
<h4 id="2、基于Zookeeper实现分布式锁"><a href="#2、基于Zookeeper实现分布式锁" class="headerlink" title="2、基于Zookeeper实现分布式锁"></a>2、基于Zookeeper实现分布式锁</h4><p>因为需要频繁的创建和删除节点，性能上不如Redis方式。</p>
<ul>
<li>实现思想：<br>1）创建一个目录mylock；<br>2）线程A想获取锁就在mylock目录下创建临时顺序节点；<br>3）获取mylock目录下所有的子节点，然后获取比自己小的兄弟节点，如果不存在，则说明当前线程顺序号最小，获得锁；<br>4）线程B获取所有节点，判断自己不是最小节点，设置监听比自己次小的节点；<br>5）线程A处理完，删除自己的节点，线程B监听到变更事件，判断自己是不是最小的节点，如果是则获得锁。</li>
</ul>
<h4 id="3、基于数据库实现分布式锁；"><a href="#3、基于数据库实现分布式锁；" class="headerlink" title="3、基于数据库实现分布式锁；"></a>3、基于数据库实现分布式锁；</h4><p>性能差，不推荐，不需要了解</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.tianfs.com/2020/10/19/%E5%88%86%E5%B8%83%E5%BC%8F%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/" data-id="ckgwgxmoj000njlh5150r45it" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tcc/" rel="tag">tcc</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/xa%E4%B8%A4%E6%AE%B5%E6%8F%90%E4%BA%A4/" rel="tag">xa两段提交</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag">分布式</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/" rel="tag">分布式事务</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-redis知识点整理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/10/19/redis%E7%9F%A5%E8%AF%86%E7%82%B9%E6%95%B4%E7%90%86/" class="article-date">
  <time datetime="2020-10-19T04:46:47.000Z" itemprop="datePublished">2020-10-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9C%8D%E5%8A%A1%E7%AB%AF/">服务端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/19/redis%E7%9F%A5%E8%AF%86%E7%82%B9%E6%95%B4%E7%90%86/">redis知识点整理(持续更新)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h2><h3 id="一、redis支持的数据类型"><a href="#一、redis支持的数据类型" class="headerlink" title="一、redis支持的数据类型"></a>一、redis支持的数据类型</h3><h4 id="string（字符串）"><a href="#string（字符串）" class="headerlink" title="string（字符串）"></a>string（字符串）</h4><ul>
<li>描述:<br>二进制安全，基本的常用的数据类型，大能存储 512MB</li>
<li>基本用法:<br>1、写入： SET key “value”<br>2、读取： GET key</li>
<li>使用场景:<br>常用的kv存取<h4 id="hash（哈希）"><a href="#hash（哈希）" class="headerlink" title="hash（哈希）"></a>hash（哈希）</h4></li>
<li>描述:<br>是一个键值(key=&gt;value)对集合，也就是一个key对应多个kv</li>
<li>基本用法:<br>1、写入：<br>多个kv：HMSET hash_key field_key1 “val1” field_key2 “val2”<br>一个kv：HSET hash_key field_key3 “val3”<br>2、读取：<br>HGET hash_key field_key1</li>
<li>使用场景:<br>例如存用户信息<h4 id="list（列表）"><a href="#list（列表）" class="headerlink" title="list（列表）"></a>list（列表）</h4></li>
<li>描述：<br>按照插入顺序排序,你可以添加一个元素到列表的头部（左边）或者尾部（右边），常用实现队列，一个列表最多可以包含 232 - 1 个元素 (4294967295, 每个列表超过40亿个元素)</li>
<li>基本用法:<br>1、头部插入:<br>LPUSH listKey val1<br>LPUSH listKey val2<br>LPUSH listKey val3<br>尾部取出：<br>RPOP listKey //val3</li>
</ul>
<p>2、尾部插入:<br>RPUSH listKey val1<br>RPUSH listKey val2<br>RPUSH listKey val3<br>头部取出：<br>RPOP listKey //val1</p>
<ul>
<li>使用场景:<br>队列实现，消息队列，商品抢购等等需要有序排队的情况<h4 id="set（集合）"><a href="#set（集合）" class="headerlink" title="set（集合）"></a>set（集合）</h4></li>
<li>描述：<br>String 类型的无序集合。成员是唯一的，不能出现重复的数据。</li>
<li>基本用法：<br>1、写入：<br>SADD set_key val1 [val…]<br>SADD set_key val2 [val…]<br>2、读取：<br>SMEMBERS set_key //读所有合集中的成员<br>SCARD set_key //获取集合的成员数<br>SREM set_key val2 [val…] //移除集合中一个或多个成员</li>
<li>使用场景:<br>例如存一个人的粉丝，交集、并集、差集等操作，可以非常方便的实现如共同关注等功能<h4 id="zset-sorted-set：有序集合"><a href="#zset-sorted-set：有序集合" class="headerlink" title="zset(sorted set：有序集合)"></a>zset(sorted set：有序集合)</h4></li>
<li>描述：<br>String 类型的有序集合。不能出现重复的数据，每个元素都会关联一个 double 类型的分数(score)，分数可重复</li>
<li>基本用法：<br>1、写入：ZADD key 分数(int) val(value) [分数(int) val(value) …]<br>2、读取：<br>ZRANGE key 0 10 WITHSCORES //从小到大取10个  从大到小用ZREVRANGE<br>ZRANGE key 0 -1 WITHSCORES //返回所有</li>
<li>使用场景:<br>例如排行榜<h3 id="二、缓存穿透、缓存击穿、缓存雪崩区别"><a href="#二、缓存穿透、缓存击穿、缓存雪崩区别" class="headerlink" title="二、缓存穿透、缓存击穿、缓存雪崩区别"></a>二、缓存穿透、缓存击穿、缓存雪崩区别</h3><h4 id="1、缓存穿透（缓存和数据库中都没有的数据）："><a href="#1、缓存穿透（缓存和数据库中都没有的数据）：" class="headerlink" title="1、缓存穿透（缓存和数据库中都没有的数据）："></a>1、缓存穿透（缓存和数据库中都没有的数据）：</h4></li>
<li>描述:<br>缓存和数据库中都没有的数据，而用户不断发起请求。常规情况存储层查不到数据则不写入缓存，导致这个不存在的数据每次请求都要到存储层去查询</li>
<li>解决:<br>1)增加查询参数校验，避免一些超过常规情况和非法的参数请求进来，例如（id：-1）<br>2)针对在数据库中找不到记录的，仍然将该空数据存入缓存中，设置一个较短的过期时间，如30秒（设置太长会导致正常情况也没法使用）<br>3)布隆过滤器(Bloom Filter)，可以快速确定数据是否存在<h4 id="2、缓存击穿（缓存没有数据和数据库中有数据，热门key，一般是缓存时间到期）："><a href="#2、缓存击穿（缓存没有数据和数据库中有数据，热门key，一般是缓存时间到期）：" class="headerlink" title="2、缓存击穿（缓存没有数据和数据库中有数据，热门key，一般是缓存时间到期）："></a>2、缓存击穿（缓存没有数据和数据库中有数据，热门key，一般是缓存时间到期）：</h4></li>
<li>描述:<br>缓存击穿表示某个key的缓存非常热门，有很高的并发一直在访问，如果该缓存失效，那同时会走数据库，压垮数据库。</li>
<li>解决:<br>1、让该热门key的缓存永不过期。<br>2、增加根据key增加互斥锁，通过redis的setnx实现互斥锁<h4 id="3、缓存雪崩（大面积缓存同时到期）"><a href="#3、缓存雪崩（大面积缓存同时到期）" class="headerlink" title="3、缓存雪崩（大面积缓存同时到期）"></a>3、缓存雪崩（大面积缓存同时到期）</h4></li>
<li>描述:<br>大面积缓存同时到期，导致大量请求来访问数据库</li>
<li>解决:<br>1、设置缓存过期时间时加上一个随机值，避免缓存在同一时间过期<h3 id="三、HyperLogLog使用与应用场景"><a href="#三、HyperLogLog使用与应用场景" class="headerlink" title="三、HyperLogLog使用与应用场景"></a>三、HyperLogLog使用与应用场景</h3><h4 id="1、HyperLogLog："><a href="#1、HyperLogLog：" class="headerlink" title="1、HyperLogLog："></a>1、HyperLogLog：</h4></li>
<li>用来做基数统计的算法，结果有 0.81%的误差，和bitmap相比更节省内存</li>
<li>bitmap用来数组来表示各元素是否出现</li>
<li>HyperLogLog基数统计的算法（去重后的次数），非redis独有</li>
<li>占用内存小</li>
<li>hyperloglog key占用了12K的内存用于标记基数<h4 id="2、基本使用"><a href="#2、基本使用" class="headerlink" title="2、基本使用"></a>2、基本使用</h4></li>
<li>pfadd 添加 :pfadd m1 1 2 3 4 1 2 3 2 2 2 2</li>
<li>pfcount 获得基数值: pfcount m1 //4</li>
<li>pfmerge 合并多个key:<br>pfadd m1 1 2 3 4 1 2 3 2 2 2 2 //1<br>pfcount m1 //4<br>pfadd m2 3 3 3 4 4 4 5 5 5 6 6 6 1 //1<br>pfcount m2 //5<br>pfmerge mergeDes m1 m2 //ok<br>pfcount mergeDes //6<h4 id="2、使用场景"><a href="#2、使用场景" class="headerlink" title="2、使用场景"></a>2、使用场景</h4></li>
<li>需要统计的数据基数很大</li>
<li>可以和bitmap配合使用，bitmap标示存在的元素，hyperloglog用来计数</li>
<li>统计注册IP数、在线人数、每日访问的uv、ip等<h3 id="四、redis的集群高可用方案"><a href="#四、redis的集群高可用方案" class="headerlink" title="四、redis的集群高可用方案"></a>四、redis的集群高可用方案</h3><h4 id="1、主从模式："><a href="#1、主从模式：" class="headerlink" title="1、主从模式："></a>1、主从模式：</h4>一个master可以拥有多个slave，但是一个slave只能对应一个master<br>主可以读写，从只能读</li>
<li>缺点：<br>主库挂了以后服务将不能写入<h4 id="2、Sentinel模式（哨兵）："><a href="#2、Sentinel模式（哨兵）：" class="headerlink" title="2、Sentinel模式（哨兵）："></a>2、Sentinel模式（哨兵）：</h4>建立在主从模式的基础上，监听redis的mater的状态，如果master挂掉了，会在slave上选出一台机器作为master<br>使用时需要连接sentinel的ip和port而不是redis的</li>
</ul>
<h4 id="3、Cluster模式："><a href="#3、Cluster模式：" class="headerlink" title="3、Cluster模式："></a>3、Cluster模式：</h4><p>在需要更大规模的存储的时候主从模式或sentinel模式就不能很好的满足需求了<br>cluster模式的解决单机Redis容量有限的问题，将Redis的数据根据一定的规则分配到多台机器<br>redis版本低的话需要安装对应版本的ruby<br>去中心化的，每个节点（master）都是平等的，连接哪个节点都可以获取和设置数据。</p>
<h3 id="四、内存回收机制"><a href="#四、内存回收机制" class="headerlink" title="四、内存回收机制"></a>四、内存回收机制</h3><h4 id="1、内存使用达到maxmemory上限时候触发的溢出回收策略"><a href="#1、内存使用达到maxmemory上限时候触发的溢出回收策略" class="headerlink" title="1、内存使用达到maxmemory上限时候触发的溢出回收策略"></a>1、内存使用达到maxmemory上限时候触发的溢出回收策略</h4><ul>
<li>noeviction（默认）: 不会删除任何数据，拒绝所有写入操作并返 回客户端错误信息，此 时Redis只响应读操作。</li>
<li>volatile-lru: 根据LRU算法删除设置了超时属性（expire）的键，直到腾出足够空间为止。如果没有可删除的键对象，回退到noeviction策略。</li>
<li>volatile-ttl: 根据键值对象的ttl属性，删除最近将要过期数据。如果没有，回退到noeviction策略。</li>
<li>allkeys-lru: 根据LRU算法删除键，不管数据有没有设置超时属性，直到腾出足够空间为止。</li>
<li>volatile-random: 随机删除过期键，直到腾出足够空间为止。</li>
<li>allkeys-random: 随机删除所有键，直到腾出足够空间为止。</li>
</ul>
<p>*** volatile-xxx 策略只会针对带过期时间的 key 进行淘汰，allkeys-xxx 策略会对所有的 key 进行淘汰</p>
<h4 id="2、删除过期时间的键对象"><a href="#2、删除过期时间的键对象" class="headerlink" title="2、删除过期时间的键对象"></a>2、删除过期时间的键对象</h4><ul>
<li>惰性删除 ： 当用户访问已经过期的对象的时候才删除</li>
<li>定时任务删除 ： 内部维护了一个定时任务，默认每秒运行10次<br>1）定时任务在每个数据库空间采用慢模式随机检查20个键，当发现过期时，删除对应的键。<br>2）如果超过检查数25%的键过期，循环执行回收逻辑直到不足25%或 运行超时为止，慢模式下超时时间为25毫秒。<br>3）如果之前回收键逻辑超时，则在Redis触发内部事件之前再次以快模式运行回收过期键任务，快模式下超时时间为1毫秒且2秒内只能运行1次。<br>4）快慢两种模式内部删除逻辑相同，只是执行的超时时间不同</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.tianfs.com/2020/10/19/redis%E7%9F%A5%E8%AF%86%E7%82%B9%E6%95%B4%E7%90%86/" data-id="ckgwgxmol000rjlh59nr90609" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/" rel="tag">redis</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%87%BB%E7%A9%BF/" rel="tag">击穿</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%A9%BF%E9%80%8F/" rel="tag">穿透</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%9B%AA%E5%B4%A9%EF%BC%8C%E9%98%9F%E5%88%97/" rel="tag">雪崩，队列</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-mysql知识点整理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/10/19/mysql%E7%9F%A5%E8%AF%86%E7%82%B9%E6%95%B4%E7%90%86/" class="article-date">
  <time datetime="2020-10-19T03:46:47.000Z" itemprop="datePublished">2020-10-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9C%8D%E5%8A%A1%E7%AB%AF/">服务端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/19/mysql%E7%9F%A5%E8%AF%86%E7%82%B9%E6%95%B4%E7%90%86/">mysql知识点整理(持续更新)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h2><h3 id="一、锁相关"><a href="#一、锁相关" class="headerlink" title="一、锁相关"></a>一、锁相关</h3><h4 id="1、悲观锁："><a href="#1、悲观锁：" class="headerlink" title="1、悲观锁："></a>1、悲观锁：</h4><ul>
<li>悲观的认为每次操作数据的时候都会有人来修改数据，所以使用数据时对其加锁，确保在自己使用的过程中数据不会被别人修改，使用完成后进行数据解锁。由于数据进行加锁，期间对该数据进行读写的其他线程都会进行等待。写入频繁使用悲观锁<h4 id="2、乐观锁："><a href="#2、乐观锁：" class="headerlink" title="2、乐观锁："></a>2、乐观锁：</h4></li>
<li>所以每次获取数据的时候都不会进行加锁，但是在更新数据的时候需要判断该数据是否被别人修改过。一般是在sql的where上带版本号或时间戳，写代码时候自己实现，读取频繁使用乐观锁<h4 id="3、共享锁：-自己读写，其他读"><a href="#3、共享锁：-自己读写，其他读" class="headerlink" title="3、共享锁：(自己读写，其他读)"></a>3、共享锁：(自己读写，其他读)</h4></li>
<li>如果事务T对数据A加上共享锁后，则其他事务只能对A再加共享锁，不能加排他锁。获准共享锁的事务只能读数据，不能修改数据。<h4 id="4、排他锁：-只能自己读写"><a href="#4、排他锁：-只能自己读写" class="headerlink" title="4、排他锁：(只能自己读写)"></a>4、排他锁：(只能自己读写)</h4></li>
<li>如果事务T对数据A加上排他锁后，则其他事务不能再对A加任任何类型的封锁。获准排他锁的事务既能读数据，又能修改数据。<h4 id="5、简要说明为什么会发生死锁"><a href="#5、简要说明为什么会发生死锁" class="headerlink" title="5、简要说明为什么会发生死锁?"></a>5、简要说明为什么会发生死锁?</h4></li>
<li>若干事务相互等待释放封锁，就陷入无限期等待状态，系统就进入死锁<h4 id="6、解决死锁的方法应从预防和解除的两个方面着手："><a href="#6、解决死锁的方法应从预防和解除的两个方面着手：" class="headerlink" title="6、解决死锁的方法应从预防和解除的两个方面着手："></a>6、解决死锁的方法应从预防和解除的两个方面着手：</h4></li>
<li>死锁的预防方法：<br>①要求每一个事务必须一次封锁所要使用的全部数据（要么全成功，要么全不成功）<br>②规定封锁数据的顺序，所有事务必须按这个顺序实行封锁。</li>
<li>允许死锁发生，然后解除它，如果发现死锁，则将其中一个代价较小的事物撤消<br>，回滚这个事务，并释放此事务持有的封锁，使其他事务继续运行。</li>
</ul>
<h3 id="二、事务隔离级别"><a href="#二、事务隔离级别" class="headerlink" title="二、事务隔离级别"></a>二、事务隔离级别</h3><h4 id="1、Read-uncommitted（读未提交）（脏读）"><a href="#1、Read-uncommitted（读未提交）（脏读）" class="headerlink" title="1、Read uncommitted（读未提交）（脏读）:"></a>1、Read uncommitted（读未提交）（脏读）:</h4><ul>
<li>在该隔离级别，所有事务都可以看到其它未提交事务的执行结果。可能会出现脏读。<h4 id="2、Read-Committed（读已提交，简称：-RC）（幻读）："><a href="#2、Read-Committed（读已提交，简称：-RC）（幻读）：" class="headerlink" title="2、Read Committed（读已提交，简称： RC）（幻读）："></a>2、Read Committed（读已提交，简称： RC）（幻读）：</h4></li>
<li>一个事务只能看见已经提交事务所做的改变。因为同一事务的其它实例在该实例处理期间可能会有新的 commit，所以可能出现幻读。<h4 id="3、Repeatable-Read（可重复读，简称：RR）（默认，结果相同）："><a href="#3、Repeatable-Read（可重复读，简称：RR）（默认，结果相同）：" class="headerlink" title="3、Repeatable Read（可重复读，简称：RR）（默认，结果相同）："></a>3、Repeatable Read（可重复读，简称：RR）（默认，结果相同）：</h4></li>
<li>这是 MySQL 的默认事务隔离级别，它确保同一事务的多个实例在并发读取数据时，会看到同样的数据行。消除了脏读、不可重复读，默认也不会出现幻读。<h4 id="4、Serializable（串行）："><a href="#4、Serializable（串行）：" class="headerlink" title="4、Serializable（串行）："></a>4、Serializable（串行）：</h4></li>
<li>这是最高的隔离级别，它通过强制事务排序，使之不可能相互冲突，从而解决幻读问题。<h3 id="三、索引"><a href="#三、索引" class="headerlink" title="三、索引"></a>三、索引</h3><a href="https://www.cnblogs.com/gdjk/p/10668868.html" target="_blank" rel="noopener">摘自</a><h4 id="1、重要概念"><a href="#1、重要概念" class="headerlink" title="1、重要概念"></a>1、重要概念</h4></li>
<li>基数：单个列唯一键（distict_keys）的数量叫做基数。</li>
<li>回表：当对一个列创建索引之后，索引会包含该列的键值及键值对应行所在的rowid。通过索引中记录的rowid访问表中的数据就叫回表。回表次数太多会严重影响SQL性能，如果回表次数太多，就不应该走索引扫描，应该直接走全表扫描。<br>EXPLAIN命令结果中的Using Index意味着不会回表，通过索引就可以获得主要的数据。Using Where则意味着需要回表取数据。</li>
</ul>
<h4 id="2、优化原则"><a href="#2、优化原则" class="headerlink" title="2、优化原则"></a>2、优化原则</h4><ul>
<li>适合索引的列是出现在where子句中的列，或者连接子句中指定的列；</li>
<li>基数- 较小的类，索引效果较差，没有必要在此列建立索引；</li>
<li>使用短索引，如果对长字符串列进行索引，应该指定一个前缀长度，这样能够节省大量索引空间；</li>
<li>不要过度索引。索引需要额外的磁盘空间，并降低写操作的性能。在修改表内容的时候，索引会进行更新甚至重构，索引列越多，这个时间就会越长。所以只保持需要的索引有利于查询即可。<h3 id="四、b-tree索、b-tree索引、hash索引"><a href="#四、b-tree索、b-tree索引、hash索引" class="headerlink" title="四、b-tree索、b-tree索引、hash索引"></a>四、b-tree索、b-tree索引、hash索引</h3><h4 id="1、b-tree"><a href="#1、b-tree" class="headerlink" title="1、b+tree"></a>1、b+tree</h4></li>
<li>B+ 树是 B 树的变体，定义基本与 B 树一致，与 B 树的不同点</li>
<li>所有叶子节点中包含了全部关键字的信息</li>
<li>非叶子节点上只存储 key 的信息，这样相对 B 树，可以增加每一页中存储 key 的数量</li>
<li>B 树是纵向扩展，最终变成一个 “瘦高个”，而 B+ 树是横向扩展的，最终会变成一个 “矮胖子”</li>
<li>各叶子节点用指针进行连接</li>
<li>mysql使用b+树索引</li>
<li>innodb索引和数据存在一个文件中</li>
<li>myisam下索引叶子节点保存数据的地址而不是数据本身<h4 id="2、b-tree"><a href="#2、b-tree" class="headerlink" title="2、b-tree"></a>2、b-tree</h4></li>
<li>多路搜索树，每个结点存储M/2到M个关键字，非叶子结点存储指向关键字范围的子结点；</li>
<li>所有关键字在整颗树中出现，且只出现一次，非叶子结点可以命中；</li>
<li>树的每个节点都包含key值和data值，叶子节点可以看作外部节点，不包含任何信息；</li>
<li>如果 data 比较大时，每一页存储的 key 会比较少；当数据比较多时，同样会有：“要经历多层节点才能查询在叶子节点的数据” 的问题。<h4 id="3、mysql中的b-tree"><a href="#3、mysql中的b-tree" class="headerlink" title="3、mysql中的b+tree"></a>3、mysql中的b+tree</h4></li>
<li>在B-树基础上，为叶子结点增加链表指针，所有关键字都在叶子结点中出现，非叶子结点作为叶子结点的索引；B+树总是到叶子结点才命中；</li>
<li>主聚集索引（clustered index）和辅助索引（secondary index）</li>
<li>具体行数据在在聚集索引上，辅助索引叶子节点存储聚集索引的key值，也就是主见</li>
<li>辅助索引的叶子节点并不包含行记录的全部数据</li>
<li>树的磁盘读写代价更低 </li>
<li>树的查询效率更加稳定 <h4 id="4、B-树："><a href="#4、B-树：" class="headerlink" title="4、B*树："></a>4、B*树：</h4></li>
<li>在B+树基础上，为非叶子结点也增加链表指针，将结点的最低利用率从1/2提高到2/3；<h4 id="5、mysql中的hash-索引"><a href="#5、mysql中的hash-索引" class="headerlink" title="5、mysql中的hash 索引"></a>5、mysql中的hash 索引</h4></li>
<li>Hash索引仅仅能满足“=”,“IN”,“&lt;=&gt;”查询，不能使用范围查询</li>
<li>联合索引中，Hash索引不能利用部分索引键查询</li>
<li>Hash索引无法避免数据的排序操作</li>
<li>Hash索引任何时候都不能避免表扫描</li>
<li>Hash索引遇到大量Hash值相等的情况后性能并不一定会比BTree高</li>
</ul>
<h3 id="五、分库、分表"><a href="#五、分库、分表" class="headerlink" title="五、分库、分表"></a>五、分库、分表</h3><h4 id="1、为什么要分表："><a href="#1、为什么要分表：" class="headerlink" title="1、为什么要分表："></a>1、为什么要分表：</h4><ul>
<li>减小数据库的单表负担，缩短查询时间，减少锁等待的情况。<h4 id="表垂直分区"><a href="#表垂直分区" class="headerlink" title="表垂直分区"></a>表垂直分区</h4></li>
<li>减少一个表中的字段，根据id关联起来<h4 id="表水平分区"><a href="#表水平分区" class="headerlink" title="表水平分区"></a>表水平分区</h4></li>
<li>使用规则（例如按id哈希、id区间、时间）分组，可以单库多表或多库多表<h4 id="分库分表后查询问题"><a href="#分库分表后查询问题" class="headerlink" title="分库分表后查询问题"></a>分库分表后查询问题</h4></li>
<li>单库多表<br>如果分表为myisam引擎的表，可以创建一个merge引擎的集合表来查询（merge引擎要求被合并表中不能又重复字段）<br>如果是innodb引擎，只能根据规则单独查询在合并或使用搜索引擎解决</li>
<li>多库多表<br>将数据通过同步插件(例如logstash)或者mq同步到Elasticsearch，然后通过lasticsearch查询，<br>如果数据量过大可以引入hbase 将数据存到hbase中，然后通过lasticsearch存储hbase的rowkey，然后查到rowkey去hbase中取数据</li>
</ul>
<h3 id="六、引擎"><a href="#六、引擎" class="headerlink" title="六、引擎"></a>六、引擎</h3><h4 id="1、innodb："><a href="#1、innodb：" class="headerlink" title="1、innodb："></a>1、innodb：</h4><ul>
<li>MySQL 5.5 之后的默认存储引擎</li>
<li>默认引擎</li>
<li>支持行锁</li>
<li>索引叶子节点存储数据</li>
<li>支持事务</li>
<li>默认select不加锁，UPDATE、INSERT、DELETE默认都是排它锁，可以通过（lock in share mode）和（for update）加共享锁和排他锁：</li>
<li>Record Lock：单个记录上的索引加锁，Gap Lock：间隙锁，对索引项之间的间隙加锁，但不包括记录本身，Next-Key Lock：Gap Lock + Record Lock，锁定一个范围，并且锁定记录本身。</li>
<li>如果不通过索引条件检索数据，那么 InnoDB 将对表中所有记录加锁，实际效果跟表锁一样（where不命中索引就锁表）。</li>
</ul>
<h4 id="2、myisam："><a href="#2、myisam：" class="headerlink" title="2、myisam："></a>2、myisam：</h4><ul>
<li>MySQL 8.0弃用 </li>
<li>MySQL 5.5 之前的默认存储引擎</li>
<li>支持表锁</li>
<li>不支持行锁</li>
<li>不支持事务</li>
<li>索- 引叶子节点只保存数据的地址而不是数据本身</li>
</ul>
<h3 id="七、explain"><a href="#七、explain" class="headerlink" title="七、explain"></a>七、explain</h3><p><a href="https://segmentfault.com/a/1190000021458117?utm_source=tag-newest" target="_blank" rel="noopener">摘自</a> </p>
<h4 id="1、用途"><a href="#1、用途" class="headerlink" title="1、用途"></a>1、用途</h4><ul>
<li>表的读取顺序如何</li>
<li>数据读取操作有哪些操作类型</li>
<li>哪些索引可以使用</li>
<li>哪些索引被实际使用</li>
<li>表之间是如何引用</li>
<li>每张- 表有多少行被优化器查询<br>……<h4 id="2、explain包含的字段"><a href="#2、explain包含的字段" class="headerlink" title="2、explain包含的字段"></a>2、explain包含的字段</h4></li>
<li>id //select查询的序列号，包含一组数字，表示查询中执行select子句或操作表的顺序</li>
<li>select_type //查询类型</li>
<li>table //正在访问哪个表</li>
<li>partitions //匹配的分区</li>
<li>type //访问的类型</li>
<li>possible_keys //显示可能应用在这张表中的索引，一个或多个，但不一定实际使用到</li>
<li>key //实际使用到的索引，如果为NULL，则没有使用索引</li>
<li>key_len //表示索引中使用的字节数，可通过该列计算查询中使用的索引的长度</li>
<li>ref //显示索引的哪一列被使用了，如果可能的话，是一个常数，哪些列或常量被用于查找索引列上的值</li>
<li>rows //根据表统计信息及索引选用情况，大致估算出找到所需的记录所需读取的行数</li>
<li>filtered //查询的表行占表的百分比</li>
<li>Extra //包含不适合在其它列中显示但十分重要的额外信息<br><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk54fpvopzj30u01sjnpd.jpg" alt="explain图"></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.tianfs.com/2020/10/19/mysql%E7%9F%A5%E8%AF%86%E7%82%B9%E6%95%B4%E7%90%86/" data-id="ckgwgxmph002rjlh5g5lq0ako" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/b%E6%A0%91/" rel="tag">b树</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%B4%A2%E5%BC%95/" rel="tag">索引</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%94%81/" rel="tag">锁</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-bitmap" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/27/bitmap/" class="article-date">
  <time datetime="2020-09-27T03:46:47.000Z" itemprop="datePublished">2020-09-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%AE%97%E6%B3%95/">算法</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/27/bitmap/">php版bitmap</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>###二进制转十进制<br>32位机器上的自然数一共有4294967296个，<br>如果用一个bit来存放一个整数，1代表存在0代表不存在，那么把全部自然数存储在内存只要4294967296 / (8 * 1024 * 1024) = 512MB（8bit = 一个字节）<br>而这些自然数存放在文件中，一行一个数字，需要20G的容量。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">     </span><br><span class="line">class BitMap</span><br><span class="line">&#123;</span><br><span class="line">    public static $map &#x3D; [];</span><br><span class="line">    &#x2F;&#x2F;插入值</span><br><span class="line">    public static function setValue($value) &#123;</span><br><span class="line">        $index &#x3D; self::getIndex($value);</span><br><span class="line">        if (isset(self::$map[$index])) &#123;</span><br><span class="line">            self::$map[$index] |&#x3D; 1 &lt;&lt; ($value &amp; 31);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            self::$map[$index] &#x3D; 1 &lt;&lt; ($value &amp; 31);</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;* (1) $value &amp; 31 相当于 $value % 32 ，</span><br><span class="line">         *  这个是取当前的值标示是否存在的位置</span><br><span class="line">         *  例如$value &#x3D; 67 得到3 位置应该是在二进制从右往左数的下标3的位置也就是第四位</span><br><span class="line">         * (2) 1 &lt;&lt; ($value &amp; 31) 就是 把当前得到的值转化成二进制的位置</span><br><span class="line">         *  例如$value &#x3D; 67 得到3  3的二进制 为11 向左偏移3位 得到2进制 1000</span><br><span class="line">         * (3) |&#x3D; 是 按位或运算并赋值</span><br><span class="line">         *  所以当前$map[$index] 的二进制的值为 1000 十进制就是8</span><br><span class="line">         *&#x2F;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        echo &quot;当前值的二进制：&quot;.(decbin($value)).&quot;\n&quot;;</span><br><span class="line">        echo &quot;取模位置左移1：&quot;.(decbin(1 &lt;&lt; ($value &amp; 31))).&#39;-&#39;.(1 &lt;&lt; ($value &amp; 31)).&quot;\n&quot;;</span><br><span class="line">        echo &quot;插入后map：&quot;.(decbin(self::$map[$index])).&#39;-&#39;.(self::$map[$index]).&quot;\n&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F;查找某个值是否存在</span><br><span class="line">    public static function haxValue($value) &#123;</span><br><span class="line">        $index &#x3D; self::getIndex($value);</span><br><span class="line">        if (!isset(self::$map[$index])) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;**</span><br><span class="line">         *  例如传入的值为87，bitmap中存的值为67</span><br><span class="line">         * (1) 1 &lt;&lt; ($value  &amp; 31) 得到1&lt;&lt;23 ,1左偏移23位，</span><br><span class="line">         * 得到 二进制值为 100000000000000000000000 也就是十进制的8388608</span><br><span class="line">         * (2) 然后和 self::$map[$index] 进行按位与（二进制1000 和 二进制 100000000000000000000000）</span><br><span class="line">         * 得到二进制 000000000000000000000000也就是十进制的0 也就是不存在</span><br><span class="line">         * 如果存在则返回这个数在self::$map[$index] 中的位置转换成的十进制的值 （如67返回8二进制也就是1000）</span><br><span class="line">         *&#x2F;</span><br><span class="line">        if ((self::$map[$index] &amp; (1 &lt;&lt; ($value  &amp; 31)))&#x3D;&#x3D;0) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static function display()</span><br><span class="line">    &#123;</span><br><span class="line">        $keys &#x3D; array_keys(self::$map);</span><br><span class="line">        foreach ($keys as $key) &#123;</span><br><span class="line">            print &quot;map index: &#123;$key&#125;, bit:\n&quot;;</span><br><span class="line">            $temp &#x3D; self::$map[$key];</span><br><span class="line">            $bit_str &#x3D; &#39;&#39;;</span><br><span class="line">            for ($i &#x3D; 0; $i &lt;&#x3D; 31; $i++) &#123;</span><br><span class="line">                $bit_str &#x3D; (1 &amp; $temp) . $bit_str;</span><br><span class="line">                echo ($bit_str).&quot;\n&quot;;</span><br><span class="line">                $temp &gt;&gt;&#x3D; 1;</span><br><span class="line">            &#125;</span><br><span class="line">            echo &quot;&#123;$bit_str&#125;\n&quot;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F;去出在数组的第几个key里面</span><br><span class="line">    private static function getIndex($value) &#123;</span><br><span class="line">        return $value &gt;&gt; 5;</span><br><span class="line">        &#x2F;**</span><br><span class="line">         * 相当于floor($value &#x2F; 32);</span><br><span class="line">         * 这里是2进制运算当前值右移动5位</span><br><span class="line">         * 例如67 二进制为1000011 右移动5位二进制为10 十进制为2</span><br><span class="line">         *&#x2F;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$list &#x3D; [67];</span><br><span class="line">foreach ($list as $value) &#123;</span><br><span class="line">    BitMap::setValue($value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">BitMap::display();</span><br><span class="line">var_dump(BitMap::haxValue(87));</span><br></pre></td></tr></table></figure>



      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.tianfs.com/2020/09/27/bitmap/" data-id="ckgwgxmo80004jlh5h7y59unu" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2进制10进制转换" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/09/2%E8%BF%9B%E5%88%B610%E8%BF%9B%E5%88%B6%E8%BD%AC%E6%8D%A2/" class="article-date">
  <time datetime="2020-09-09T03:46:47.000Z" itemprop="datePublished">2020-09-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%AE%97%E6%B3%95/">算法</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/09/2%E8%BF%9B%E5%88%B610%E8%BF%9B%E5%88%B6%E8%BD%AC%E6%8D%A2/">2进制10进制转换</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>###二进制转十进制 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">例：二进制110101转10进制</span><br><span class="line">= 1 * 2^5 + 1 * 2^4 + 0 * 2^3 + 1 * 2^2 + 0 * 2^1 + 1 * 2^0</span><br><span class="line">= 32 + 16 + 0 + 4 + 0 + 1</span><br><span class="line">= 53</span><br></pre></td></tr></table></figure>
<p>上面是2进制转10进制所以是用2的次方 ， 如果3制转10进制那就用3的次方</p>
<p>###十进制转2进制 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">例：十进制53转2进制 </span><br><span class="line">= 53/2  = 26 余1</span><br><span class="line">= 26/2  = 3  余0</span><br><span class="line">= 13/2  = 6  余1 </span><br><span class="line">= 6/2   = 3  余0</span><br><span class="line">= 3/2   = 1  余1</span><br><span class="line">= 1/2   = 0  余1 </span><br><span class="line">然后余数倒序 = 110101</span><br></pre></td></tr></table></figure>
<p>上面是转2进制所以除2 ， 如果转3进制就除3 ，4进制就除4</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.tianfs.com/2020/09/09/2%E8%BF%9B%E5%88%B610%E8%BF%9B%E5%88%B6%E8%BD%AC%E6%8D%A2/" data-id="ckgwgxmo50001jlh5125e31u7" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-MySQL修改root密码的几种方法" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/06/09/MySQL%E4%BF%AE%E6%94%B9root%E5%AF%86%E7%A0%81%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E6%B3%95/" class="article-date">
  <time datetime="2020-06-09T03:46:47.000Z" itemprop="datePublished">2020-06-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/mysql/">mysql</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/06/09/MySQL%E4%BF%AE%E6%94%B9root%E5%AF%86%E7%A0%81%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E6%B3%95/">MySQL修改root密码的几种方法</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="方法1：-用SET-PASSWORD命令"><a href="#方法1：-用SET-PASSWORD命令" class="headerlink" title="方法1： 用SET PASSWORD命令"></a>方法1： 用SET PASSWORD命令</h3><p>首先登录MySQL。</p>
<p>格式：mysql&gt; set password for 用户名@localhost = password(‘新密码’);</p>
<p>例子：mysql&gt; set password for root@localhost = password(‘admin100’);</p>
<p>上面例子将用户root的密码更改为admin100</p>
<h3 id="方法2：用mysqladmin"><a href="#方法2：用mysqladmin" class="headerlink" title="方法2：用mysqladmin"></a>方法2：用mysqladmin</h3><p>格式：mysqladmin -u用户名 -p旧密码 password 新密码</p>
<p>例子：mysqladmin -uroot -p123456 password admin100</p>
<p>上面例子将用户root原来的密码123456改为新密码admin100</p>
<h3 id="方法3：用UPDATE直接编辑user表"><a href="#方法3：用UPDATE直接编辑user表" class="headerlink" title="方法3：用UPDATE直接编辑user表"></a>方法3：用UPDATE直接编辑user表</h3><p>首先登录MySQL。</p>
<p>mysql&gt; use mysql;</p>
<p>mysql&gt; update user set password=password(‘admin100’) where user=’root’ and host=’localhost’;</p>
<p>mysql&gt; flush privileges;</p>
<h3 id="方法4：在忘记root密码的时候，可以这样。"><a href="#方法4：在忘记root密码的时候，可以这样。" class="headerlink" title="方法4：在忘记root密码的时候，可以这样。"></a>方法4：在忘记root密码的时候，可以这样。</h3><p>以windows为例：</p>
<ol>
<li><p>关闭正在运行的MySQL服务。</p>
</li>
<li><p>打开DOS窗口，转到mysql\bin目录。</p>
</li>
<li><p>输入mysqld –skip-grant-tables 回车。–skip-grant-tables 的意思是启动MySQL服务的时候跳过权限表认证。</p>
</li>
<li><p>再开一个DOS窗口（因为刚才那个DOS窗口已经不能动了），转到mysql\bin目录。</p>
</li>
<li><p>输入mysql回车，如果成功，将出现MySQL提示符 &gt;。</p>
</li>
<li><p>连接权限数据库： use mysql; 。</p>
</li>
<li><p>改密码：update user set password=password(“admin100”) where user=”root”;（别忘了最后加分号） 。</p>
</li>
<li><p>刷新权限（必须步骤）：flush privileges;。</p>
</li>
<li><p>退出  quit。</p>
</li>
<li><p>注销系统，再进入，使用用户名root和刚才设置的新密码admin100登录。</p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.tianfs.com/2020/06/09/MySQL%E4%BF%AE%E6%94%B9root%E5%AF%86%E7%A0%81%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E6%B3%95/" data-id="ckgwgxmny0000jlh50lre9ybs" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-css定位绝对居中办法" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/06/09/css%E5%AE%9A%E4%BD%8D%E7%BB%9D%E5%AF%B9%E5%B1%85%E4%B8%AD%E5%8A%9E%E6%B3%95/" class="article-date">
  <time datetime="2020-06-09T03:46:47.000Z" itemprop="datePublished">2020-06-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/web%E5%89%8D%E7%AB%AF/">web前端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/06/09/css%E5%AE%9A%E4%BD%8D%E7%BB%9D%E5%AF%B9%E5%B1%85%E4%B8%AD%E5%8A%9E%E6%B3%95/">css定位绝对居中办法</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">position: absolute;</span><br><span class="line">left: 50%;</span><br><span class="line">top: 50%;</span><br><span class="line">transform: translate(-50%, -50%);</span><br><span class="line">-webkit-transform:translate(-50%, -50%);</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.tianfs.com/2020/06/09/css%E5%AE%9A%E4%BD%8D%E7%BB%9D%E5%AF%B9%E5%B1%85%E4%B8%AD%E5%8A%9E%E6%B3%95/" data-id="ckgwgxmo90005jlh5dlkx5mld" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/css/" rel="tag">css</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/html/" rel="tag">html</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web%E5%89%8D%E7%AB%AF/" rel="tag">web前端</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/">javascript</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/php/">php</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web%E5%89%8D%E7%AB%AF/">web前端</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF/">后端技术</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9C%8D%E5%8A%A1%E7%AB%AF/">服务端</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AE%97%E6%B3%95/">算法</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/b%E6%A0%91/" rel="tag">b树</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/" rel="tag">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/elasticsearch/" rel="tag">elasticsearch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html/" rel="tag">html</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/" rel="tag">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kibana/" rel="tag">kibana</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/" rel="tag">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php%E7%8E%AF%E5%A2%83/" rel="tag">php环境</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/" rel="tag">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tcc/" rel="tag">tcc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web%E5%89%8D%E7%AB%AF/" rel="tag">web前端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xa%E4%B8%A4%E6%AE%B5%E6%8F%90%E4%BA%A4/" rel="tag">xa两段提交</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%87%BB%E7%A9%BF/" rel="tag">击穿</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag">分布式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/" rel="tag">分布式事务</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%A9%BF%E9%80%8F/" rel="tag">穿透</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%B4%A2%E5%BC%95/" rel="tag">索引</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%94%81/" rel="tag">锁</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9B%AA%E5%B4%A9%EF%BC%8C%E9%98%9F%E5%88%97/" rel="tag">雪崩，队列</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/b%E6%A0%91/" style="font-size: 10px;">b树</a> <a href="/tags/css/" style="font-size: 16.67px;">css</a> <a href="/tags/docker/" style="font-size: 13.33px;">docker</a> <a href="/tags/elasticsearch/" style="font-size: 10px;">elasticsearch</a> <a href="/tags/html/" style="font-size: 16.67px;">html</a> <a href="/tags/http/" style="font-size: 10px;">http</a> <a href="/tags/javascript/" style="font-size: 10px;">javascript</a> <a href="/tags/kibana/" style="font-size: 10px;">kibana</a> <a href="/tags/mysql/" style="font-size: 16.67px;">mysql</a> <a href="/tags/php/" style="font-size: 13.33px;">php</a> <a href="/tags/php%E7%8E%AF%E5%A2%83/" style="font-size: 10px;">php环境</a> <a href="/tags/redis/" style="font-size: 10px;">redis</a> <a href="/tags/tcc/" style="font-size: 10px;">tcc</a> <a href="/tags/web%E5%89%8D%E7%AB%AF/" style="font-size: 16.67px;">web前端</a> <a href="/tags/xa%E4%B8%A4%E6%AE%B5%E6%8F%90%E4%BA%A4/" style="font-size: 10px;">xa两段提交</a> <a href="/tags/%E5%87%BB%E7%A9%BF/" style="font-size: 10px;">击穿</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 10px;">分布式</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/" style="font-size: 10px;">分布式事务</a> <a href="/tags/%E7%A9%BF%E9%80%8F/" style="font-size: 10px;">穿透</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 20px;">算法</a> <a href="/tags/%E7%B4%A2%E5%BC%95/" style="font-size: 10px;">索引</a> <a href="/tags/%E9%94%81/" style="font-size: 10px;">锁</a> <a href="/tags/%E9%9B%AA%E5%B4%A9%EF%BC%8C%E9%98%9F%E5%88%97/" style="font-size: 10px;">雪崩，队列</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/10/21/docker%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98/">docker遇到的一些问题</a>
          </li>
        
          <li>
            <a href="/2020/10/21/docker%E5%AE%89%E8%A3%85php%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/">docker安装php开发环境</a>
          </li>
        
          <li>
            <a href="/2020/10/20/elasticsearch%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/">elasticsearch知识整理</a>
          </li>
        
          <li>
            <a href="/2020/10/19/%E5%88%86%E5%B8%83%E5%BC%8F%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/">分布式知识整理</a>
          </li>
        
          <li>
            <a href="/2020/10/19/redis%E7%9F%A5%E8%AF%86%E7%82%B9%E6%95%B4%E7%90%86/">redis知识点整理(持续更新)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 tianfs<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//libs.baidu.com/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>